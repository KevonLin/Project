var USERINFO_PARA = new Array("Type", "Enable", "Username", "Password", "Right"); function getmsg(id) { var str = new Array(); str[0] = new Array(102, "长度有误，请输入长度为"); str[1] = new Array(103, "之间的字符。"); str[2] = new Array(114, "有误，请输入合法字符。"); str[3] = new Array(118, "当前操作无效，请检查"); str[4] = new Array(119, "是否合法。"); str[5] = new Array(122, "当前操作无效，请检查配置参数。"); str[6] = new Array(123, "有误，请重新输入。"); str[7] = new Array(124, "新密码确认与新密码不一致，请重新输入。"); str[8] = new Array(101, "不允许为空，请重新输入。"); return getMsgFormArray(str, arguments); } function pageLoad(url) { getObj("fSubmit").action = url; CreatHaddin(); pageGetValue(); var errstr = getValue("IF_ERRORSTR"); var errpara = getValue("IF_ERRORPARAM"); OldProcessRet(errstr, errpara); } function CreatHaddin() { var oNewNode = document.createElement("input"); oNewNode.setAttribute("type", "hidden"); oNewNode.setAttribute("id", "OldPassword"); oNewNode.setAttribute("name", "OldPassword"); oNewNode.setAttribute("value", ""); document.getElementById("fSubmit").appendChild(oNewNode); } function pageGetValue() { jslSetValue("Frm_Username", "Username"); } function pageSetValue() { HiddenParaInit(USERINFO_PARA); var OldPassword = getValue("Frm_OldPassword"); var login_random = 49976180; OldPassword = sha256(OldPassword + login_random); jslSetValue("Username", "Frm_Username"); setValue("OldPassword", OldPassword); jslSetValue("Password", "Frm_Password"); } function pageCheckValue() { var msg = ""; var Username = getValue("Frm_Username"); var Frm_Password = getValue("Frm_Password"); var Frm_CfmPassword = getValue("Frm_CfmPassword"); if (Username == "") { msg = getmsg(101); ShowErrorForCom("Frm_Username", "Fnt_Username", msg); return false; } if (checkStrLengthRange(Username, 1, 16) == -3) { msg = getmsg(102, 1, 16); ShowErrorForCom("Frm_Username", "Fnt_Username", msg); return false; } if (checkGenStringForASC(getValue("Frm_Password")) != true) { msg = getmsg(114); ShowErrorForCom("Frm_Password", "Fnt_Password", msg); return false; } var value = getValue("Frm_Password"); if (checkStrLengthRange(value, 0, 32) == -3) { msg = getmsg(102, 0, 32); ShowErrorForCom("Frm_Password", "Fnt_Password", msg); return false; } if (checkGenStringForASC(getValue("Frm_CfmPassword")) != true) { msg = getmsg(114); ShowErrorForCom("Frm_CfmPassword", "Fnt_CfmPassword", msg); return false; } if (Frm_Password != Frm_CfmPassword) { msg = getmsg(124); ShowErrorForCom("Frm_CfmPassword", null, msg); return false; } if (getValue("Right") == "1") { if (getObj("UserRight0").checked == true && getValue("Frm_Password") == "") { msg = getmsg(101); ShowErrorForCom("Frm_Password", "Fnt_Password", msg); return false; } } return true; } function PasswordCheck() { var msg = "密码强度较弱，"; var patt1 = /^.{8,}$/; var patt2 = /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[~`_!@#$%^&*(){ }\[\]'"\|\\\\:;<>=?\/,.+-])[0-9a-zA-Z~`_!@#$%^&*(){ }\[\]'"\|\\\\:;<>=?\/,.+-]{0,}$/; var newPassword = getValue("Frm_Password"); if (patt1.test(newPassword) != true) { msg = msg + "密码不能少于8位，"; ShowErrorForCom("Frm_Password", "Fnt_Password", msg); return false; } if (patt2.test(newPassword) != true) { msg = msg + "密码必须由数字、字母和符号(包含空格)三者组成！"; ShowErrorForCom("Frm_Password", "Fnt_Password", msg); return false; } return true; } function pageCancel() { DisableALL(); getObj("fSubmit").submit(); } function pageSubmit() { if (pageCheckValue() == true && PasswordCheck() == true) { DisableALL(); pageSetValue(); setValue("IF_ACTION", "apply"); getObj("fSubmit").submit(); } else { } } function RightSetValue(rightid) { jslSetValue("Type", "Type" + rightid); jslSetValue("Right", "Right" + rightid); jslSetValue("Enable", "Enable" + rightid); jslSetValue("Username", "Username" + rightid); } function Doadmin(id) { RightSetValue(id); setValue("IF_INDEX", id); pageGetValue(); jslEnable("Frm_Username"); jslEnDisplay("InputPassword"); setValue("Frm_OldPassword", ""); setChecked("UserRight" + id, true); } function Douser(id) { RightSetValue(id); setValue("IF_INDEX", id); pageGetValue(); jslDisable("Frm_Username"); jslDiDisplay("InputPassword"); jslSetValue("OldPassword", "Password" + id); jslSetValue("Frm_OldPassword", "Password" + id); setChecked("UserRight" + id, true); }